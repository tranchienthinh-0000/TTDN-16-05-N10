<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- FORM VIEW -->
    <record id="view_thiet_bi_form" model="ir.ui.view">
      <field name="name">thiet_bi_form</field>
      <field name="model">thiet_bi</field>
      <field name="arch" type="xml">
        <form string="Chi tiết thiết bị">
          <sheet>
            <group col="2">
              <group string="Thông tin thiết bị">
                <field name="name" required="1"/>
                <field name="loai_thiet_bi" required="1"/>
                <field name="trang_thai"/>
                <field name="mo_ta" placeholder="Ghi chú mô tả tình trạng/đặc điểm thiết bị..."/>
              </group>

              <group string="Kho / Vị trí hiện tại">
                <field name="vi_tri_hien_tai"/>
                <field name="phong_hien_tai_id"
                       attrs="{'invisible':[('vi_tri_hien_tai','=','kho')],
                              'required':[('vi_tri_hien_tai','=','phong')]}"/>

                <separator string="Liên kết tài sản"/>

                <field name="tai_san_id"
                       domain="[('active','=',True), ('trang_thai','!=','DaThanhLy')]"
                       options="{'no_create_edit': False, 'no_open': False}"
                       placeholder="Chọn tài sản tương ứng (nếu có)"/>

                <field name="loai_tai_san_id" readonly="1"/>
                <field name="ma_tai_san" readonly="1"/>
                <field name="so_serial" readonly="1"/>
                <field name="trang_thai_tai_san" readonly="1"/>
              </group>
            </group>
          </sheet>
        </form>
      </field>
    </record>

    <!-- TREE VIEW -->
    <record id="view_thiet_bi_tree" model="ir.ui.view">
      <field name="name">thiet_bi_tree</field>
      <field name="model">thiet_bi</field>
      <field name="arch" type="xml">
        <tree string="Danh sách thiết bị" default_order="trang_thai asc, name asc"
              decoration-danger="trang_thai == 'hong'"
              decoration-warning="trang_thai == 'can_bao_tri'"
              decoration-success="trang_thai == 'san_sang'">
          <field name="name"/>
          <field name="loai_thiet_bi"/>
          <field name="trang_thai"/>
          <field name="vi_tri_hien_tai"/>
          <field name="phong_hien_tai_id"/>

          <field name="tai_san_id"/>
          <field name="loai_tai_san_id"/>
          <field name="ma_tai_san"/>
          <field name="so_serial"/>
        </tree>
      </field>
    </record>

    <!-- SEARCH VIEW -->
    <record id="view_thiet_bi_search" model="ir.ui.view">
      <field name="name">thiet_bi_search</field>
      <field name="model">thiet_bi</field>
      <field name="arch" type="xml">
        <search string="Tìm kiếm thiết bị">
          <field name="name"/>
          <field name="loai_thiet_bi"/>
          <field name="trang_thai"/>
          <field name="vi_tri_hien_tai"/>
          <field name="phong_hien_tai_id"/>
          <field name="tai_san_id"/>
          <field name="loai_tai_san_id"/>
          <field name="ma_tai_san"/>
          <field name="so_serial"/>

          <separator/>

          <filter string="Sẵn sàng" name="filter_san_sang" domain="[('trang_thai', '=', 'san_sang')]"/>
          <filter string="Đang sử dụng" name="filter_dang_su_dung" domain="[('trang_thai', '=', 'dang_su_dung')]"/>
          <filter string="Cần bảo trì" name="filter_can_bao_tri" domain="[('trang_thai', '=', 'can_bao_tri')]"/>
          <filter string="Hỏng" name="filter_hong" domain="[('trang_thai', '=', 'hong')]"/>

          <separator/>

          <filter string="Trong kho" name="filter_kho" domain="[('vi_tri_hien_tai', '=', 'kho')]"/>
          <filter string="Trong phòng" name="filter_phong" domain="[('vi_tri_hien_tai', '=', 'phong')]"/>

          <group expand="0" string="Nhóm theo">
            <filter string="Loại thiết bị" name="group_loai" context="{'group_by': 'loai_thiet_bi'}"/>
            <filter string="Trạng thái" name="group_trang_thai" context="{'group_by': 'trang_thai'}"/>
            <filter string="Vị trí" name="group_vi_tri" context="{'group_by': 'vi_tri_hien_tai'}"/>
            <filter string="Phòng hiện tại" name="group_phong" context="{'group_by': 'phong_hien_tai_id'}"/>
            <filter string="Loại tài sản" name="group_loai_ts" context="{'group_by': 'loai_tai_san_id'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- ACTION -->
    <record id="action_thiet_bi" model="ir.actions.act_window">
      <field name="name">Quản lý thiết bị</field>
      <field name="res_model">thiet_bi</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="view_thiet_bi_search"/>
      <field name="context">{}</field>
    </record>

  </data>
</odoo>
