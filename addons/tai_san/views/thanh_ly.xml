<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- TREE -->
    <record id="view_thanh_ly_tree" model="ir.ui.view">
      <field name="name">thanh_ly.tree</field>
      <field name="model">thanh_ly</field>
      <field name="arch" type="xml">
        <tree string="Danh sách thanh lý"
              decoration-success="trang_thai == 'done'"
              decoration-danger="trang_thai == 'cancelled'"
              decoration-warning="trang_thai == 'confirmed'"
              decoration-info="trang_thai == 'draft'">
          <field name="ma_thanh_ly"/>
          <field name="ngay_thanh_ly"/>
          <field name="tai_san_id"/>
          <field name="gia_tri_thanh_ly"/>
          <field name="nguoi_xu_ly_id"/>
          <field name="trang_thai"/>
        </tree>
      </field>
    </record>

    <!-- FORM -->
    <record id="view_thanh_ly_form" model="ir.ui.view">
      <field name="name">thanh_ly.form</field>
      <field name="model">thanh_ly</field>
      <field name="arch" type="xml">
        <form string="Phiếu thanh lý">
          <header>
            <button name="action_confirm" type="object" string="Xác nhận" class="btn-primary"
                    attrs="{'invisible': [('trang_thai', '!=', 'draft')]}"/>
            <button name="action_done" type="object" string="Hoàn thành" class="btn-primary"
                    attrs="{'invisible': [('trang_thai', '!=', 'confirmed')]}"/>
            <button name="action_cancel" type="object" string="Hủy" class="btn-danger"
                    attrs="{'invisible': [('trang_thai', 'in', ('done','cancelled'))]}"/>
            <field name="trang_thai" widget="statusbar" statusbar_visible="draft,confirmed,done,cancelled"/>
          </header>

          <sheet>
            <div class="oe_title">
              <h1><field name="ma_thanh_ly" readonly="1"/></h1>
            </div>

            <group>
              <group string="Thông tin phiếu">
                <field name="ngay_thanh_ly" required="1"/>

                <field name="tai_san_id"
                       options="{'no_create': True}"
                       domain="[('thanh_ly_id', '=', False)]"
                       attrs="{'readonly': [('trang_thai','!=','draft')]}"/>

                <field name="gia_tri_thanh_ly" required="1"
                       attrs="{'readonly': [('trang_thai','!=','draft')]}"/>

                <field name="nguoi_xu_ly_id"
                       options="{'no_create': True}"
                       attrs="{'readonly': [('trang_thai','!=','draft')]}"/>
              </group>

              <group string="Lý do">
                <field name="ly_do" colspan="2"
                       attrs="{'readonly': [('trang_thai','!=','draft')]}"/>
              </group>
            </group>
          </sheet>

        </form>
      </field>
    </record>

    <!-- SEARCH (FIXED) -->
    <record id="view_thanh_ly_search" model="ir.ui.view">
      <field name="name">thanh_ly.search</field>
      <field name="model">thanh_ly</field>
      <field name="arch" type="xml">
        <search string="Tìm kiếm thanh lý">
          <field name="ma_thanh_ly"/>
          <field name="tai_san_id"/>
          <field name="nguoi_xu_ly_id"/>
          <field name="trang_thai"/>
          <field name="ngay_thanh_ly"/>

          <separator/>

          <filter name="f_draft" string="Nháp" domain="[('trang_thai','=','draft')]"/>
          <filter name="f_confirmed" string="Đã xác nhận" domain="[('trang_thai','=','confirmed')]"/>
          <filter name="f_done" string="Hoàn thành" domain="[('trang_thai','=','done')]"/>
          <filter name="f_cancel" string="Đã hủy" domain="[('trang_thai','=','cancelled')]"/>

          <group expand="1" string="Nhóm theo">
            <filter name="grp_trang_thai" string="Trạng thái" context="{'group_by':'trang_thai'}"/>
            <filter name="grp_nguoi_xu_ly" string="Người xử lý" context="{'group_by':'nguoi_xu_ly_id'}"/>
            <filter name="grp_ngay_thanh_ly" string="Ngày thanh lý" context="{'group_by':'ngay_thanh_ly'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- ACTION -->
    <record id="action_thanh_ly" model="ir.actions.act_window">
      <field name="name">Thanh lý tài sản</field>
      <field name="res_model">thanh_ly</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="view_thanh_ly_search"/>
    </record>

  </data>
</odoo>
